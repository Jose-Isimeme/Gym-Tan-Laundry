<%- include('partials/header.ejs') %>

<!-- Flexbox page container -->
<h1 id="intro"><%=pageTitle%></h1>
        <div id="songContainer" class="row py-1 px-3">
           <!-- Players rendered here -->
           <% songs.map(song => { %>
            <iframe src="https://open.spotify.com/embed/track/<%= song %>" width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
          <% })   %> 
        </div>
<div id="buttonDiv" class="mx-auto d-flex justify-content-center p-3">
 
  <button id="startOver" class="btn btn-warning mr-2">
    <img src="./Images/refresh.png" alt="" id="refreshIcon">Start over </button>
  <button id="spotifyDashboard" class="btn btn-success">Login to save/edit with
    <img src="./Images/spotify.png" alt="" id="spotifyIcon">
  </button>

</div>

<div id="button2">
  <a href="/push-to-playlist"><button id="postToSpotify" class="center btn btn-success">Post your playlist to spotify
    <img src="./Images/spotify.png" alt="" id="spotifyIcon">
  </button>
  </a>
</div>

<script>
  // grabbed songs array
 var songsList = "<%= songs %>"
 // Attempting to grab the tracks-id or playlist-id that's being injected into the iframe src above.
  // afterwhich hopefully storing that value in a variable, then we can push that ID up to our own database
var songsFrame = document.getElementsByTagName('iframe');
// am able to get object syntax only so far
var tracksID = songsFrame.item(0);

/*
document.getElementById('postToSpotify').addEventListener('click', function() {

  axios.post('http:localhost:3002/makeplaylist', songsList)
  .then(res =>{
    debugger;
  })
})
*/
const loginWithSpotifyButton = document.getElementById('spotifyDashboard')

loginWithSpotifyButton.addEventListener('click', function(){

  //Source https://developer.mozilla.org/en-US/docs/Web/API/Window/open
 const spotifyWindow= window.open('/auth/spotify', 'Spotify Login', "resizable,scrollbars,status,width=500,height=500")
 console.log(spotifyWindow)
 var timer = setInterval(function() { 
    if(spotifyWindow.closed) {
        clearInterval(timer);
        console.log('Closed!')

    }
}, 1000);

})


</script>

<%- include('partials/footer.ejs') %>
